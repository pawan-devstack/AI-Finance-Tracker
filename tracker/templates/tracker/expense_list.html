{% extends 'tracker/base.html' %}
{% block title %}Expense List{% endblock %}
{% block content %}

<div class="max-w-6xl mx-auto">
  <h2 class="text-3xl font-bold text-center text-blue-600 mb-8">
    ğŸ’° Your Expenses
  </h2>

  {% if expenses %}
  <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {% for expense in expenses %}
    <div class="bg-white p-5 rounded-2xl shadow hover:shadow-xl transition transform hover:-translate-y-1">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-lg font-semibold text-gray-800">{{ expense.title }}</h3>
        <span class="text-sm text-gray-500">{{ expense.date|date:"d M, Y" }}</span>
      </div>

      <p class="text-2xl font-bold text-blue-600 mb-2">â‚¹{{ expense.amount }}</p>
      <p class="text-gray-600 text-sm mb-4">ğŸ·ï¸ {{ expense.category }}</p>

      <div class="flex justify-between">
        <a href="{% url 'edit_expense' expense.id %}"
           class="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded-lg text-sm">
          âœï¸ Edit
        </a>
        <a href="{% url 'delete_expense' expense.id %}"
           onclick="return confirm('Are you sure you want to delete this expense?');"
           class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm">
          ğŸ—‘ï¸ Delete
        </a>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="mt-10 text-center">
    <p class="text-xl font-semibold text-gray-800">
      ğŸ’µ Total: <span class="text-blue-600">â‚¹{{ total }}</span>
    </p>
  </div>

  {% else %}
  <p class="text-center text-gray-600 mt-8">No expenses added yet.</p>
  {% endif %}

  <div class="text-center mt-8">
    <a href="{% url 'add_expense' %}"
       class="bg-green-500 hover:bg-green-600 text-white px-5 py-2 rounded-lg shadow-md">
      â• Add New Expense
    </a>
  </div>
</div>

<!-- Category Chart -->
<div class="mt-12 bg-white p-6 rounded-2xl shadow-lg">
  <h3 class="text-2xl font-bold text-center text-gray-800 mb-4">ğŸ“Š Spending by Category</h3>
  <canvas id="expenseChart" width="400" height="200"></canvas>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('expenseChart').getContext('2d');

  // Data passed from Django context
  const categories = {{ categories|safe }};
  const totals = {{ totals|safe }};

  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: categories,
      datasets: [{
        label: 'Expenses by Category',
        data: totals,
        backgroundColor: [
          '#3b82f6',
          '#f97316',
          '#22c55e',
          '#eab308',
          '#ef4444',
          '#a855f7'
        ],
        borderWidth: 1,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
        },
        title: {
          display: true,
          text: 'Category-wise Expense Distribution'
        }
      }
    }
  });
</script>

<!-- AI Suggestions Section -->
<div class="mt-12 bg-linear-to-r from-blue-50 to-purple-50 p-6 rounded-2xl shadow-lg">
  <h3 class="text-2xl font-bold text-gray-800 mb-4">ğŸ¤– Smart Spending Insights</h3>
  
  {% if suggestions %}
    <ul class="space-y-3">
      {% for suggestion in suggestions %}
        <li class="bg-white border-l-4 border-blue-500 p-3 rounded-lg shadow-sm hover:shadow-md transition">
          ğŸ’¡ {{ suggestion }}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-gray-600">No insights available yet. Add expenses to see your spending analysis.</p>
  {% endif %}
</div>

{% endblock %}
